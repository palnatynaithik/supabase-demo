<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>EduTrack - Parent  Dashboard</title>
<script src="https://cdn.tailwindcss.com"></script>
<script type="module" src="supabaseClient.js"></script>
</head>
<body class="bg-gray-100 min-h-screen">

<header class="bg-green-600 text-white p-6 flex justify-between items-center">
  <h1 class="text-2xl font-bold">EduTrack - Parent  Dashboard</h1>
  <button id="logoutBtn" class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded-lg">Logout</button>
</header>

<main class="p-8">

  <section>
    <h2 class="text-2xl font-bold mb-4 text-green-600">Your Wards</h2>
    <div class="overflow-x-auto bg-white rounded-xl shadow-lg p-4">
      <table class="min-w-full table-auto">
        <thead>
          <tr class="bg-green-100 text-left">
            <th class="px-4 py-2">ID</th>
            <th class="px-4 py-2">Name</th>
            <th class="px-4 py-2">Grade</th>
            <th class="px-4 py-2">Actions</th>
          </tr>
        </thead>
        <tbody id="studentsBody"></tbody>
      </table>
    </div>
  </section>

</main>

<script type="module">
import { supabase } from './supabaseClient.js'

// Logout
document.getElementById('logoutBtn').addEventListener('click', async ()=>{
  await supabase.auth.signOut()
  window.location.href = 'auth.html'
})

// Check if current user is a parent
async function checkParent(){
  const user = supabase.auth.user()
  const { data, error } = await supabase.from('parent').select('*').eq('id', user.id)
  if(!data || data.length === 0){
    alert('Access denied: Only Parents can access this page.')
    window.location.href = 'auth.html'
  }
}

// Fetch all students
async function fetchStudents(){
  const { data, error } = await supabase.from('students').select('*')
  const studentsBody = document.getElementById('studentsBody')
  studentsBody.innerHTML = ''
  if(data){
    data.forEach(s=>{
      const row = document.createElement('tr')
      row.innerHTML = `
        <td class="px-4 py-2">${s.id}</td>
        <td class="px-4 py-2">${s.name}</td>
        <td class="px-4 py-2">${s.grade}</td>
        <td class="px-4 py-2">
          <button onclick="editStudent('${s.id}','${s.name}','${s.grade}')" class="bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded-lg">Edit</button>
        </td>
      `
      studentsBody.appendChild(row)
    })
  }
}

// Edit student function
window.editStudent = async (id, name, grade) => {
  const newName = prompt('Enter new name:', name)
  const newGrade = prompt('Enter new grade:', grade)
  if(newName && newGrade){
    await supabase.from('students').update({name: newName, grade: parseInt(newGrade)}).eq('id', id)
    fetchStudents()
  }
}

// Initialize
checkTeacher().then(fetchStudents)
</script>
</body>
</html>
