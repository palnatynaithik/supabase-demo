<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>EduTrack - Admin Dashboard</title>
<script src="https://cdn.tailwindcss.com"></script>
<script type="module" src="supabaseClient.js"></script>
</head>
<body class="bg-gray-100 min-h-screen">

<header class="bg-blue-600 text-white p-6 flex justify-between items-center">
  <h1 class="text-2xl font-bold">EduTrack - Admin Dashboard</h1>
  <button id="logoutBtn" class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded-lg">Logout</button>
</header>

<main class="p-8 grid grid-cols-1 md:grid-cols-2 gap-8">

  <!-- Add Student Role Entry -->
  <section class="bg-white p-6 rounded-xl shadow-lg">
    <h2 class="text-xl font-semibold mb-4 text-blue-600">Add Student Role Entry</h2>
    <form id="addStudentForm" class="space-y-3">
      <input type="text" id="addStudentId" placeholder="User ID (from Auth)" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-400">
      <input type="text" id="addStudentName" placeholder="Name" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-400">
      <input type="number" id="addStudentGrade" placeholder="Grade" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-400">
      <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded-lg">Add Student</button>
    </form>
    <p id="studentMessage" class="mt-2 text-center"></p>
  </section>

  <!-- Add Teacher Role Entry -->
  <section class="bg-white p-6 rounded-xl shadow-lg">
    <h2 class="text-xl font-semibold mb-4 text-blue-600">Add Teacher Role Entry</h2>
    <form id="addTeacherForm" class="space-y-3">
      <input type="text" id="addTeacherId" placeholder="User ID (from Auth)" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-400">
      <input type="text" id="addTeacherName" placeholder="Name" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-400">
      <input type="text" id="addTeacherPhone" placeholder="Phone" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-400">
      <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded-lg">Add Teacher</button>
    </form>
    <p id="teacherMessage" class="mt-2 text-center"></p>
  </section>

</main>

<section class="p-8">
  <h2 class="text-2xl font-bold mb-4 text-blue-600">All Users</h2>
  <div class="overflow-x-auto bg-white rounded-xl shadow-lg p-4">
    <table class="min-w-full table-auto">
      <thead>
        <tr class="bg-blue-100 text-left">
          <th class="px-4 py-2">ID</th>
          <th class="px-4 py-2">Name</th>
          <th class="px-4 py-2">Role</th>
          <th class="px-4 py-2">Actions</th>
        </tr>
      </thead>
      <tbody id="allUsersBody"></tbody>
    </table>
  </div>
</section>

<script type="module">
import { supabase } from './supabaseClient.js'

// Logout
document.getElementById('logoutBtn').addEventListener('click', async ()=>{
  await supabase.auth.signOut()
  window.location.href = 'auth.html'
})

// Add Student Role Entry
const addStudentForm = document.getElementById('addStudentForm')
const studentMessage = document.getElementById('studentMessage')
addStudentForm.addEventListener('submit', async e=>{
  e.preventDefault()
  const id = document.getElementById('addStudentId').value
  const name = document.getElementById('addStudentName').value
  const grade = parseInt(document.getElementById('addStudentGrade').value)
  try{
    await supabase.from('students').insert([{id, name, grade}])
    studentMessage.textContent = 'Student role entry added!'
    studentMessage.className = 'mt-2 text-green-600 text-center'
    addStudentForm.reset()
    fetchAllUsers()
  }catch(err){
    studentMessage.textContent = 'Error: '+err.message
    studentMessage.className = 'mt-2 text-red-600 text-center'
  }
})

// Add Teacher Role Entry
const addTeacherForm = document.getElementById('addTeacherForm')
const teacherMessage = document.getElementById('teacherMessage')
addTeacherForm.addEventListener('submit', async e=>{
  e.preventDefault()
  const id = document.getElementById('addTeacherId').value
  const name = document.getElementById('addTeacherName').value
  const phone = document.getElementById('addTeacherPhone').value
  try{
    await supabase.from('teachers').insert([{id, name, phone}])
    teacherMessage.textContent = 'Teacher role entry added!'
    teacherMessage.className = 'mt-2 text-green-600 text-center'
    addTeacherForm.reset()
    fetchAllUsers()
  }catch(err){
    teacherMessage.textContent = 'Error: '+err.message
    teacherMessage.className = 'mt-2 text-red-600 text-center'
  }
})

// Fetch all users
async function fetchAllUsers(){
  const allUsersBody = document.getElementById('allUsersBody')
  allUsersBody.innerHTML = ''

  const tables = ['students','teachers','parents','admins']
  for(let table of tables){
    const { data, error } = await supabase.from(table).select('*')
    if(error) continue
    data.forEach(u=>{
      const role = table.slice(0,-1).charAt(0).toUpperCase() + table.slice(1,-1)
      const row = document.createElement('tr')
      row.innerHTML = `
        <td class="px-4 py-2">${u.id}</td>
        <td class="px-4 py-2">${u.name}</td>
        <td class="px-4 py-2">${role}</td>
        <td class="px-4 py-2">
          <button onclick="deleteUser('${table}','${u.id}')" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-lg">Delete</button>
        </td>
      `
      allUsersBody.appendChild(row)
    })
  }
}

// Delete user
window.deleteUser = async (table, id)=>{
  if(!confirm('Delete this user?')) return
  await supabase.from(table).delete().eq('id', id)
  fetchAllUsers()
}

// Initial load
fetchAllUsers()
</script>
</body>
</html>
