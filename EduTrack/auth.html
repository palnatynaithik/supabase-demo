<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>EduTrack Login</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="styles.css">
</head>
<body class="bg-[var(--bg-light)] flex items-center justify-center min-h-screen">

<div class="bg-white shadow-xl rounded-2xl p-10 w-96">
  <h1 class="text-3xl font-semibold mb-6 text-[var(--primary-blue)] text-center">EduTrack Login</h1>

  <input type="email" id="email" placeholder="Email"
    class="w-full mb-4 px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-[var(--primary-light)] text-base">
  <input type="password" id="password" placeholder="Password"
    class="w-full mb-4 px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-[var(--primary-light)] text-base">

  <div class="flex justify-between gap-2">
    <button id="loginBtn"
      class="bg-[var(--primary-light)] hover:bg-[var(--primary-blue)] text-white px-5 py-3 rounded-xl font-medium w-1/2 transition">Login</button>
    <button id="signupBtn"
      class="bg-green-600 hover:bg-green-700 text-white px-5 py-3 rounded-xl font-medium w-1/2 transition">Sign Up</button>
  </div>
</div>

<script type="module">
import { supabase } from './supabaseClient.js'

const loginBtn = document.getElementById('loginBtn')
const signupBtn = document.getElementById('signupBtn')
const email = document.getElementById('email')
const password = document.getElementById('password')

async function redirectToRolePage(userId){
  const { data: adminData } = await supabase.from('admins').select('*').eq('id', userId).single()
  if(adminData) return window.location.href='dashboard_admin.html'

  const { data: teacherData } = await supabase.from('teachers').select('*').eq('id', userId).single()
  if(teacherData) return window.location.href='dashboard_teacher.html'

  const { data: studentData } = await supabase.from('students').select('*').eq('id', userId).single()
  if(studentData) return window.location.href='dashboard_student.html'

  const { data: parentData } = await supabase.from('parents').select('*').eq('id', userId).single()
  if(parentData) return window.location.href='dashboard_parent.html'
}

loginBtn.addEventListener('click', async () => {
  const { data, error } = await supabase.auth.signInWithPassword({ email: email.value, password: password.value })
  if(error) return alert(error.message)
  await redirectToRolePage(data.user.id)
})

signupBtn.addEventListener('click', async () => {
  const { data, error } = await supabase.auth.signUp({ email: email.value, password: password.value })
  if(error) return alert(error.message)
  alert('Signed up! Confirm your email.')
})
</script>
</body>
</html>
